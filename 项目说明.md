# Solana 质押 DApp 项目说明

## 项目概述

这是一个基于 Solana 区块链的质押（Staking）去中心化应用（DApp），使用 Anchor 框架开发智能合约，Vue 3 构建前端界面。

## 项目结构

```
staking_dapp/
├── programs/
│   └── staking_dapp/
│       └── src/
│           └── lib.rs          # 智能合约核心代码
├── tests/
│   └── staking_dapp.js         # 合约测试文件
├── app/                        # Vue 前端应用
│   ├── src/
│   │   ├── App.vue            # 主应用组件
│   │   ├── main.js            # 入口文件
│   │   ├── style.css          # 样式文件
│   │   └── utils/
│   │       ├── solana.js      # Solana 交互工具
│   │       └── config.js      # 配置文件
│   ├── public/
│   │   └── idl/
│   │       └── staking_dapp.json  # 合约 IDL 文件
│   ├── package.json
│   └── vite.config.js
├── Anchor.toml                 # Anchor 配置文件
└── package.json               # 项目依赖
```

## 核心功能

### 智能合约功能

1. **初始化质押池（initializePool）**
   - 创建质押池账户
   - 设置质押代币和奖励代币
   - 创建代币保险库（Vault）
   - 设置奖励比例（默认 10%）

2. **质押代币（stake）**
   - 用户将代币转入质押池
   - 记录用户质押数量
   - 更新总质押量

3. **取消质押（unstake）**
   - 用户从质押池提取代币
   - 检查用户质押余额
   - 更新用户质押记录和总质押量

4. **领取奖励（claimRewards）**
   - 根据质押数量计算奖励（质押数量 / 奖励比例）
   - 铸造奖励代币给用户

### 前端功能

1. **钱包连接**
   - 支持 Phantom 钱包
   - 显示钱包地址
   - 钱包状态管理

2. **数据展示**
   - 总质押量统计
   - 用户质押数量
   - 奖励比例显示
   - 可领取奖励计算

3. **交易操作**
   - 质押代币（需要输入数量）
   - 取消质押（需要输入数量）
   - 领取奖励（一键领取）

4. **用户体验**
   - 实时状态更新
   - 交易成功/失败提示
   - 加载状态显示
   - 响应式设计

## 技术栈

### 后端（智能合约）
- **Rust** - 系统编程语言
- **Anchor** - Solana 开发框架
- **SPL Token** - Solana 代币标准

### 前端
- **Vue 3** - 渐进式 JavaScript 框架
- **Vite** - 前端构建工具
- **@solana/web3.js** - Solana JavaScript SDK
- **@coral-xyz/anchor** - Anchor JavaScript SDK
- **@solana/spl-token** - SPL 代币库

## 使用说明

### 前置要求

1. **安装 Solana CLI**
   ```bash
   sh -c "$(curl -sSfL https://release.solana.com/stable/install)"
   ```

2. **安装 Anchor**
   ```bash
   cargo install --git https://github.com/coral-xyz/anchor avm --locked --force
   anchor --version
   ```

3. **安装 Node.js 和 npm**

4. **安装 Phantom 钱包浏览器扩展**

### 部署和运行

#### 1. 启动本地 Solana 测试节点

```bash
solana-test-validator
```

#### 2. 部署智能合约

在项目根目录：

```bash
# 构建合约
anchor build

# 部署合约
anchor deploy
```

#### 3. 初始化质押池（可选）

如果池还未初始化，需要运行测试脚本来初始化：

```bash
npm test
```

#### 4. 运行前端应用

```bash
cd app
npm install
npm run dev
```

访问 `http://localhost:3000`

### 配置说明

#### 合约地址

合约程序 ID：`7V6ovzHukZ3ow9kKeT3KyYQbLjGbHoLHg58YwfkPaWvE`

在以下文件中确认程序 ID 一致：
- `programs/staking_dapp/src/lib.rs`（declare_id!）
- `app/src/utils/config.js`（PROGRAM_ID）

#### 网络配置

在 `app/src/utils/config.js` 中可以修改网络：

```javascript
// 本地测试网
export const NETWORK = 'http://127.0.0.1:8899'

// 开发网
// export const NETWORK = 'https://api.devnet.solana.com'

// 主网
// export const NETWORK = 'https://api.mainnet-beta.solana.com'
```

#### 代币精度

默认代币精度为 6 位小数，可在以下位置调整：
- 合约中创建 Mint 时指定
- `app/src/utils/config.js` 中的 `TOKEN_DECIMALS`

## 工作流程

1. **初始化阶段**
   - 部署合约
   - 创建质押代币（Stake Mint）和奖励代币（Reward Mint）
   - 初始化质押池

2. **用户操作**
   - 连接钱包
   - 获得质押代币（通过 Mint 或交易）
   - 质押代币到池中
   - 领取奖励（基于质押数量计算）
   - 取消质押（提取代币）

3. **奖励机制**
   - 奖励比例：10%（固定）
   - 计算公式：可领取奖励 = 质押数量 / 10
   - 奖励通过铸造奖励代币分发

## 安全注意事项

1. **代币权限**
   - 奖励 Mint 的权限需要转移给 Pool PDA
   - 确保权限管理正确

2. **金额验证**
   - 合约中已实现金额验证
   - 前端也需要进行输入验证

3. **PDA 派生**
   - 使用标准 seeds 派生 PDA
   - 确保 PDA 派生的一致性

## 扩展建议

1. **时间锁** - 添加质押时间要求
2. **动态奖励率** - 根据时间或池规模调整奖励
3. **多池支持** - 支持多个质押池
4. **治理** - 添加 DAO 治理功能
5. **统计分析** - 更详细的数据分析和图表
6. **历史记录** - 记录用户的质押历史

## 常见问题

### Q: 无法连接钱包？

A: 确保已安装 Phantom 钱包，并且钱包连接到正确的网络（localnet/devnet/mainnet）。

### Q: 交易失败？

A: 检查：
- 钱包余额是否充足
- 代币余额是否足够
- 网络连接是否正常
- 合约是否已部署

### Q: 无法加载池信息？

A: 确保：
- 合约已部署
- 池已初始化
- IDL 文件正确
- 网络配置正确

## 许可证

ISC

## 作者

Solana 质押 DApp 开发团队

